(function(l){var f="cpptable",s="cpptable-tbody",n="cpptable-thead",d="cpptable-tfoot",c="cpptable-radio",p="cpptable-checkbox",a="cpptable-radio-w",m="cpptable-checkbox-w",y="cpptable-checkall",r="cpptable-page",g="cpptable-prev",i="cpptable-next",t="cpptable-first",b="cpptable-last",q="cpptable-current",h="cpptable-disable",z="cpptable-highlight";var e=function(B,D){B=l.extend({isTh:false,isHide:false,wrapClass:null,innerClass:null,key:null,val:"",type:"text",name:null,width:null},B);var C=B.isTh?l("<th>"):l("<td>"),A;if(B.key){C.attr("key",B.key)}if(B.wrapClass){C.addClass(B.wrapClass)}if(B.type=="text"){}else{if(l.isFunction(B.type)){A=l(B.type(D))}else{if(B.type=="textbox"){A=l("<input type='text'>").val(B.val)}else{if(B.type=="radio"){A=l("<input type='radio'>")}else{if(B.type=="checkbox"){A=l("<input type='checkbox'>")}}}}}if(A&&B.innerClass){A.addClass(B.innerClass)}if(A&&B.name){A.attr("name",B.name)}if(B.type=="text"){C.text(B.val).attr("title",B.val)}else{C.append(A)}if(B.width){C.width(B.width)}return C},k=function(G,F){var E,C=0,B;for(var D=0,A=F.cols.length;D<A;D++){E=l.extend({isHide:false},F.cols[D]);l("[key='"+E.code+"']",G).toggle(!E.isHide);E.isHide||C++}l("."+a,G).toggle(F.showRadio);F.showRadio&&C++;l("."+m,G).toggle(F.showCheckBox);F.showCheckBox&&C++;l("."+d,G).toggle(F.showPage);if(F.showPage){l("."+d+" td",G).attr("colspan",C);B=(F.pageNum==0);l("."+t,G).toggleClass(h,B);l("."+g,G).toggleClass(h,B);F.totalPage=Math.ceil(F.total/F.pageSize);B=(F.totalPage<=(F.pageNum+1));l("."+i,G).toggleClass(h,B);l("."+b,G).toggleClass(h,B);l("."+q,G).html("第<span class='"+z+"'>"+(F.pageNum+1)+"</span>/"+F.totalPage+"页")}},u=function(H,B,G){var F=l("<tr>"),D,C;F.append(e({wrapClass:a,innerClass:c,type:"radio",name:G.radioName},H));F.append(e({wrapClass:m,innerClass:p,type:"checkbox"},H));for(var E=0,A=G.cols.length;E<A;E++){D=G.cols[E];C=l.extend({},D,{key:D.code,val:H[D.code]||"",width:null});F.append(e(C,H))}B.append(F)},o=function(E,B,D){for(var C=0,A=E.length;C<A;C++){u(E[C],B,D)}},j=function(A){l("."+s,A).empty()},v=function(B,A){return B?(A?l("<span class='"+B+"'>").text(A):l("<span class='"+B+"'>")):l("<span>")},w=function(A,B){if(A.url){var C=l.extend({_pageNum:A.pageNum,_pageSize:A.pageSize},A.condition);A.onBeforeQuery();l.ajax({url:A.url,type:A.type,dataType:"json",data:C,success:function(D){A.total=D.total;j(B);o(D.rows,l("."+s,B),A);k(B,A);A.onAfterQuery()},error:A.error})}else{A.queryHandler(A.pageNum,A.pageSize,B)}};var x={init:function(A){return this.each(function(){var J=l(this);var C=J.data(f);if(typeof(C)=="undefined"){C=l.extend({},l.fn.cpptable.defaults,A);if(!C.radioName){C.radioName=J.attr("id")+"_R"}J.empty().addClass(f);var I=l("<tr class='"+n+"'>"),E=l("<tbody class='"+s+"'>"),L=l("<tr class='"+d+"'>"),H,N;I.append(e({isTh:true,wrapClass:a},null));H=e({isTh:true,wrapClass:m,innerClass:y,type:"checkbox"},null);I.append(H);for(var F=0,G=C.cols.length,O;F<G;F++){O=C.cols[F];N=l.extend({},O,{isTh:true,key:O.code,val:O.name,type:"text"});I.append(e(N,null))}var K=v(t+" "+r,"首页"),M=v(g+" "+r,"上一页"),B=v(i+" "+r,"下一页"),D=v(b+" "+r,"尾页"),P=v(q+" "+r);l("<td>").append(K).append(M).append(P).append(B).append(D).appendTo(L);l("<thead>").append(I).appendTo(J);E.appendTo(J);l("<tfoot>").append(L).appendTo(J)}else{C=l.extend({},C,A)}l("."+y,H).on("click",function(){var Q=l(this).prop("checked");l("."+p,E).each(function(R,S){l(S).prop("checked",Q)})});E.delegate("."+p,"click",function(){var Q=true;l("."+p,E).each(function(R,S){Q=Q&&l(S).prop("checked")});l("."+y,H).prop("checked",Q)});L.delegate("."+r,"click",function(){var Q=l(this),R=J.data(f);if(Q.is("."+h)){return}if(Q.is("."+t)){R.pageNum=0}else{if(Q.is("."+g)){R.pageNum--}else{if(Q.is("."+i)){R.pageNum++}else{if(Q.is("."+b)){R.pageNum=R.totalPage-1}else{return}}}}J.data(f,R);w(R,J)});k(J,C);J.data(f,C)})},destroy:function(A){return l(this).each(function(){var B=l(this);B.empty().removeClass(f);B.removeData(f)})},val:function(B){var A=this.eq(0).html();return A},clear:function(){return l(this).each(function(){j(l(this))})},addRow:function(A){return l(this).each(function(){var D=l(this),B=l("."+s,D),C=D.data(f);if(!C){l.error("can not read options from element data.")}if(l.isArray(A)){o(A,B,C)}else{if(typeof(A)=="object"){u(A,B,C)}else{l.error("param error on cpptable.addRow.")}}k(D,C)})},set:function(A,B){return l(this).each(function(){var C=l(this).data(f);if(A in C){C[A]=B}l(this).data(f,C)})},get:function(A){return l(this).each(function(){var B=l(this).data(f);if(A in B){return B[A]}return null})},query:function(){return l(this).each(function(){var B=l(this),A=B.data(f);w(A,B)})}};l.fn.cpptable=function(){var A=arguments[0];if(x[A]){A=x[A];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(A)=="object"||!A){A=x.init}else{l.error("Method "+A+" does not exist on jQuery.cpptable");return this}}return A.apply(this,arguments)};l.fn.cpptable.defaults={cols:[],showRadio:false,showCheckBox:false,radioName:null,showPage:false,pageSize:10,pageNum:0,total:0,totalPage:0,url:null,type:"POST",dataType:"json",queryHandler:l.noop,condition:null,error:l.noop,onBeforeQuery:l.noop,onAfterQuery:l.noop}})(jQuery);